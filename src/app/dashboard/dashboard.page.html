<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/inicio-alumno"></ion-back-button>
    </ion-buttons>
    <ion-title>
      <ion-icon name="analytics-outline" style="margin-right: 8px;"></ion-icon>
      Dashboard
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  
  <!-- Header del Usuario -->
  <ion-card class="user-card">
    <ion-card-content>
      <div class="user-info">
        <ion-avatar class="user-avatar">
          <ion-icon name="person-circle-outline"></ion-icon>
        </ion-avatar>
        <div class="user-details">
          <h2>{{ currentUser?.email }}</h2>
          <p>{{ userRole === 'alumno' ? 'Estudiante' : 'Profesor' }}</p>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Estadísticas Principales -->
  <ion-card class="stats-card">
    <ion-card-header>
      <ion-card-title class="card-title">
        <ion-icon name="stats-chart-outline" class="title-icon"></ion-icon>
        Estadísticas de Asistencia
      </ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-number" [class]="getAttendanceColor(attendancePercentage)">
            {{ attendancePercentage }}%
          </div>
          <div class="stat-label">Asistencia General</div>
        </div>

        <div class="stat-item">
          <div class="stat-number primary">{{ attendedClasses }}/{{ totalClasses }}</div>
          <div class="stat-label">Clases Asistidas</div>
        </div>

        <div class="stat-item">
          <div class="stat-number success">{{ currentStreak }}</div>
          <div class="stat-label">Racha Actual</div>
        </div>

        <div class="stat-item">
          <div class="stat-number warning">{{ longestStreak }}</div>
          <div class="stat-label">Mejor Racha</div>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Alertas -->
  <ion-card *ngIf="alerts.length > 0" class="alerts-card">
    <ion-card-header>
      <ion-card-title class="card-title">
        <ion-icon name="notifications-outline" class="title-icon"></ion-icon>
        Alertas y Notificaciones
      </ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <ion-list>
        <ion-item *ngFor="let alert of alerts" [class]="'alert-item ' + alert.type">
          <ion-icon [name]="alert.icon" slot="start" [color]="getAlertColor(alert.type)"></ion-icon>
          <ion-label>
            <h3>{{ alert.title }}</h3>
            <p>{{ alert.message }}</p>
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <!-- Rendimiento por Clase -->
  <ion-card class="performance-card">
    <ion-card-header>
      <ion-card-title class="card-title">
        <ion-icon name="school-outline" class="title-icon"></ion-icon>
        Rendimiento por Clase
      </ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <ion-list>
        <ion-item *ngFor="let class of classPerformance" class="class-item">
          <ion-label>
            <h3>{{ class.class }}</h3>
            <p>Asistencia: {{ class.attendance }}%</p>
          </ion-label>
          <ion-icon 
            [name]="getTrendIcon(class.trend)" 
            slot="end" 
            [color]="getTrendColor(class.trend)">
          </ion-icon>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <!-- Próximas Clases -->
  <ion-card class="upcoming-card">
    <ion-card-header>
      <ion-card-title class="card-title">
        <ion-icon name="calendar-outline" class="title-icon"></ion-icon>
        Próximas Clases
      </ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <ion-list>
        <ion-item *ngFor="let class of upcomingClasses" class="upcoming-item">
          <ion-icon name="time-outline" slot="start" color="primary"></ion-icon>
          <ion-label>
            <h3>{{ class.name }}</h3>
            <p>{{ class.subject }}</p>
            <p><strong>{{ class.time }}</strong> - {{ class.date }} - {{ class.professor }}</p>
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <!-- Datos Semanales -->
  <ion-card class="weekly-card">
    <ion-card-header>
      <ion-card-title class="card-title">
        <ion-icon name="calendar-number-outline" class="title-icon"></ion-icon>
        Asistencia Semanal
      </ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <div class="weekly-chart">
        <div class="chart-container">
          <div *ngFor="let day of weeklyData" class="day-bar">
            <div class="bar-label">{{ day.day }}</div>
            <div class="bar-container">
              <div 
                class="attendance-bar" 
                [style.height.%]="day.total > 0 ? (day.attended / day.total) * 100 : 0"
                [class.attended]="day.attended > 0"
                [class.missed]="day.total > 0 && day.attended === 0">
              </div>
            </div>
            <div class="bar-value">{{ day.attended }}/{{ day.total }}</div>
          </div>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Acciones Rápidas -->
  <ion-card class="actions-card">
    <ion-card-header>
      <ion-card-title class="card-title">
        <ion-icon name="flash-outline" class="title-icon"></ion-icon>
        Acciones Rápidas
      </ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <div class="actions-grid">
        <ion-button expand="block" class="action-button" routerLink="/escanear">
          <ion-icon name="qr-code-outline" slot="start"></ion-icon>
          Escanear QR
        </ion-button>

        <ion-button expand="block" class="action-button" routerLink="/asistencia">
          <ion-icon name="list-outline" slot="start"></ion-icon>
          Ver Historial
        </ion-button>

        <ion-button expand="block" class="action-button" routerLink="/perfil">
          <ion-icon name="person-outline" slot="start"></ion-icon>
          Mi Perfil
        </ion-button>

        <ion-button expand="block" class="action-button" (click)="initializeNotifications()">
          <ion-icon name="notifications-outline" slot="start"></ion-icon>
          Configurar Notificaciones
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

</ion-content> 